{% extends 'posts/layout.html' %} {% load static %}
{% load social_share %}

{% block content %}
  <!-- Post Content Column -->
  <div class="row">
    <div class="col-md-9">
      <div class="card shadow-sm my-4">
      <!-- Title -->
      <div class="card-body">
      <h2 class="mt-4" id='post-title'><div>{{post.title}}</div>
        <div class="dropdown">
            <button class="btn btn-link" type="button" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <i class="fas fa-share-square"></i>
            </button>
          <div class="dropdown-menu">
            <input type="text" class="form-control" value='{{request.build_absolute_uri}}' disabled>
          </div>
        </div>
      </h2>

      <small class='text-muted'>
        Published by: <a href="#"><i class='fas fa-user-tie'></i>&nbsp;{{post.author}}</a> |
          Posted: <i class='fas fa-calendar-alt'></i>&nbsp;{{post.created}} |
          Updated: <i class='fas fa-calendar-alt'></i>&nbsp;{{post.updated}}
      </small>

<ul class="list-group list-group-horizontal">
  <li class="list-group-item">{% post_to_twitter "Post: {{post.title}}. Check it out!" object_or_url '<i class="fab fa-twitter-square text-info" style="font-size:36px"></i>' %}</li>
  <li class="list-group-item">{% post_to_reddit "Post: {{post.title}}" object_or_url '<i class="fab fa-reddit-square" style="font-size:36px;color:red"></i>' %}</li>
  <li class="list-group-item">{% post_to_whatsapp object_or_url '<i class="fab fa-whatsapp-square" style="font-size:36px;color:green"></i>' %}</li>
  <li class="list-group-item">{% post_to_facebook object_or_url '<i class="fab fa-facebook-square" style="font-size:36px;color:blue"></i>' %}</li>
  <li class="list-group-item">{% send_email post.title "Post: {{post.title}}. Check it out!" object_or_url '<i class="fas fa-envelope-square text-warning" style="font-size:36px"></i>' %}</li>
</ul>
        <!-- <div>
          {% post_to_twitter "Post: {{post.title}}. Check it out!" object_or_url '<i class="fab fa-twitter-square"></i>' %} |
          {% post_to_reddit "Post: {{post.title}}" object_or_url '<i class="fab fa-reddit-square"></i>' %} |
          {% post_to_facebook object_or_url '<i class="fab fa-facebook-square"></i>' %} |
          {% post_to_whatsapp object_or_url '<i class="fab fa-whatsapp-square"></i>' %} |
          {% send_email post.title "Post: {{post.title}}. Check it out!" object_or_url '<i class="fas fa-envelope-square"></i>' %}
        </div> -->
      <!-- Post Content -->
      <p class="lead">{{post.content|safe|linebreaks}}</p>
      </div>
    </div>

      <hr />

      <!-- Comments Form -->
      {% if request.user.is_authenticated %}
        <h5 class="card-header">Leave a Comment:</h5>
        <br>
          <form method='POST' style='margin-bottom: 2px;'>
            {% csrf_token %}
            <div class="form-group">
            <label class='d-none'>{{comment_form.body.label}}</label>
            <!-- {{comment_form.media}} -->
              {{comment_form.body}}
              </div>
            <button type="submit" class="btn btn-primary">Comment</button>
          </form>
      {% else %}
      <p>Please <a href="{% url 'login' %}" target='_blank'>Login</a> first to comment.</p>
      {% endif %}
      <!-- Single Comment -->
      {% with comments.count as total_comments %}
        <p>{{total_comments}} comment{{total_comments|pluralize}}</p>
      {% endwith %}
      <hr>
      {% for comment in comments %}
      <div class="media mb-4">
        <img
          class="d-flex mr-3 rounded-circle"
          src="{{comment.user.profile.profile_pic.url}}"
          alt="profile pic"
          id="profile-pic"
        />
        <div class="media-body">
          <h6 class="mt-0">
            {{comment.user.username}} <small>on {{comment.created}}</small>
          </h6>
          {{comment.body|safe}}
          {% if comment.user == request.user %}
          <div>
          <a href="{% url 'posts:comment-edit' comment.id %}">Edit</a> 
          <a href="{% url 'posts:comment-delete' comment.id %}">Delete</a>
          </div>
          {% endif %}
        </div>
      </div>
      {% endfor %}
      </div>
    <div class="col-md-3">
      <div class="card my-4 shadow-sm">
        <div class="card-body">
          <h3>About Author</h3>
          <hr>
          <img src="{{post.author.profile.profile_pic.url}}" alt="" id='profile-pic-sidebar'>
          <p>{{post.author.username}}</p>
          <p>{{post.author.profile.bio}}</p>
        </div>
      </div>
    </div>
  </div>


{% endblock %}
